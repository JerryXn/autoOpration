## 目标
- 在图文详情页进行人类化浏览（下滑、左右滑图、停留）并记录完整的浏览行为与笔记信息。
- 产生结构化数据供后续分析与回放：一次会话、一条笔记、若干交互事件、媒体快照。

## 数据模型
- 会话 Session
  - `runId`、`platform`=`xhs`、`detailUrl`、`referrerUrl`
  - `startedAt`、`endedAt`、`durationMs`、`viewport`（宽高、设备像素比）
  - `userIntervention`（true/false、时刻、原因）、`riskFlags`（如 404/受限提示）
- 笔记 NoteInfo
  - `noteId`、`title`、`authorName`、`authorId`、`authorHomeUrl`
  - `publishTime`、`tags[]/topics[]/category`（可选）
  - `stats`：`likes`、`collects`、`comments`（可选，能取到则记录）
  - `media`：`images[]`（`index`、`src`、`width`、`height`、`naturalWidth`、`naturalHeight`、`hash`）、`video?`
- 交互 InteractionLog
  - `events[]`：时间序列（`type`、`ts`、`payload`）
    - `scroll`：`fromY`、`toY`、`durationMs`、`easing`
    - `swipe`：`direction`=left|right、`from(x,y)`、`to(x,y)`、`durationMs`
    - `hover`：`x,y`、`durationMs`
    - `click`：`x,y`、`targetSelector`
    - `keydown/keyup/char`：`key`、`code`
  - 汇总：`scrollDepthMax`、`imageViewedIndices[]`、`swipeCountLeft/Right`
- 存储文件
  - `session.jsonl`：每次会话一行 JSON（含 NoteInfo + InteractionLog）
  - `media/`：可选缓存图片或截图；记录 `filePath` 与 `hash`

## DOM采集（小红书图文详情）
- 定位笔记ID与标题
  - `location.pathname` 提取 `/explore/{noteId}`
  - 标题：`h1` 或详情卡片内的标题节点（按页面结构兜底多个选择器）
- 作者信息
  - 作者名与主页链接：详情卡片作者区的 `a[href*="/user/profile"]`
- 媒体图片
  - 图片列表选择器：轮播容器内 `img` 或 `picture img`；按渲染结构筛选可见、去重同 `src`
- 统计数据（可选）
  - 点赞/收藏/评论：详情操作区的数字（存在则取；否则留空）

## 人类化浏览策略
- 进入详情后：
  - `idle` 停留 1.2–3.0 秒，记录 `hover`（在图片或正文区域中心）
  - 下滑：分段滚动（随机距离、时长、缓动），目标到正文尾部或评论区顶部
  - 左右滑：在图片轮播区域执行 1–3 次左右滑（生成 `pointerDown→pointerMove→pointerUp` 或拖动事件路径）
  - 图片查看：在当前图片上短暂停留并记录 `imageViewedIndices[]`
- 随机化参数
  - 延迟、移动步数、路径抖动、停留时长（配置化且受限于速率）

## 事件记录与写盘
- 渲染进程累积 `events[]` 并周期性/结束时通过 IPC 发送到主进程
- 主进程落盘（JSONL），按日期分文件：`data/autoop/xhs/YYYY-MM-DD.jsonl`
- 图片：
  - 默认只保存 URL 与尺寸；如启用缓存则下载前 N 张到 `media/`，生成 `sha256` 与 `filePath`

## 反风控与停止机制
- 所有动作通过 `webContents.sendInputEvent`，带缓动与抖动，避免机械路径
- 检测 404/受限提示层：若出现，记录 `riskFlags` 并切换到下一候选（若在浏览阶段）
- 监听本地鼠标键盘：一旦用户介入，立即停止会话并写出完整记录（标记 `userIntervention=true`）

## 接口与配置
- 渲染 API
  - `startBrowseSession(noteUrl, options)`、`stopBrowseSession(runId)`
  - `recordEvent(event)`、`finalizeSession()`
- 选项 `options`
  - `scrollRange`、`swipeCount`、`hoverRange`、`cacheImages`、`maxImages`
  - `delayRange`（全局随机延迟）、`humanizeLevel`

## 验证
- 控制台输出关键日志：开始/结束、滚动段、滑动方向、图片索引、最大滚动深度、受限提示命中
- 写盘后随机抽检一条 JSON，验证字段完整性与图片 URL 数量

## 示例记录（JSON）
```json
{
  "runId": "xhs-20251126-001",
  "platform": "xhs",
  "detailUrl": "https://www.xiaohongshu.com/explore/66bb0492...",
  "startedAt": 1732600000000,
  "endedAt": 1732600018000,
  "durationMs": 18000,
  "viewport": { "w": 1200, "h": 900, "dpr": 2 },
  "userIntervention": false,
  "riskFlags": [],
  "note": {
    "noteId": "66bb0492...",
    "title": "秋冬护肤实测",
    "authorName": "某作者",
    "authorId": "5fabc...",
    "authorHomeUrl": "https://www.xiaohongshu.com/user/profile/5fabc...",
    "publishTime": null,
    "stats": { "likes": 1234, "collects": 456, "comments": 78 },
    "media": {
      "images": [
        { "index": 0, "src": "https://.../img0.jpg", "width": 800, "height": 1000, "naturalWidth": 1080, "naturalHeight": 1440 },
        { "index": 1, "src": "https://.../img1.jpg", "width": 800, "height": 1000, "naturalWidth": 1080, "naturalHeight": 1440 }
      ]
    }
  },
  "events": [
    { "type": "hover", "ts": 1732600002000, "payload": { "x": 620, "y": 400, "durationMs": 800 } },
    { "type": "scroll", "ts": 1732600004000, "payload": { "fromY": 0, "toY": 780, "durationMs": 900, "easing": "easeOutQuad" } },
    { "type": "swipe", "ts": 1732600006200, "payload": { "direction": "left", "from": { "x": 700, "y": 420 }, "to": { "x": 420, "y": 420 }, "durationMs": 450 } },
    { "type": "swipe", "ts": 1732600007200, "payload": { "direction": "right", "from": { "x": 420, "y": 420 }, "to": { "x": 720, "y": 420 }, "durationMs": 470 } }
  ],
  "summary": { "scrollDepthMax": 1820, "imageViewedIndices": [0,1], "swipeLeft": 1, "swipeRight": 1 }
}
```

## 输出与呈现
- 前端“浏览记录”区域显示：标题、作者、首图缩略图、浏览时长、滑动次数、滚动深度、JSON 复制按钮
- 支持导出当日 JSONL 与图片缓存打包

## 交付步骤
1. 在渲染进程实现 DOM 采集与事件累积，IPC 上报
2. 主进程落盘（JSONL）与可选图片缓存
3. 在自动运营页增加“记录开关”和“查看今日记录”入口
4. 加入日志抽样验证与错误提示（受限/未取到图片等）

请确认以上设计，我即可开始实现并联调。