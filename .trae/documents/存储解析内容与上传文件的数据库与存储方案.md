## 直接回答
- 目前上传的图片/视频文件并没有落盘或入库，只在前端内存中以 `ObjectURL` 方式预览；页面关闭后即失效。需要新增“本地持久化+数据库记录”的流程来保存。

## 目标
- 为“解析成功的图文/视频”建立数据库记录，按 `type` 区分（`image_text`/`video`），与用户 `user_id` 关联。
- 为上传文件建立稳定的存储位置与元数据记录，并与内容记录关联。

## 数据库设计（MySQL）
- `parsed_contents`（存储解析出的发布数据）
  - `id BIGINT PK AUTO_INCREMENT`
  - `user_id BIGINT NOT NULL`（关联 `users.id`）
  - `platform_code VARCHAR(32)`（如 `xhs`/`douyin`/`mp`）
  - `type ENUM('image_text','video') NOT NULL`
  - `subject VARCHAR(255)`、`title VARCHAR(255)`、`content TEXT`
  - `cover_refs JSON`（封面引用数组：逻辑文件名或 `media_files.id`）
  - `image_refs JSON`（配图引用数组）
  - `video_ref VARCHAR(255)`（视频单一引用，图文为空）
  - `status ENUM('draft','ready','published') DEFAULT 'draft'`
  - `created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`
- `media_files`（存储上传文件元数据）
  - `id BIGINT PK AUTO_INCREMENT`
  - `user_id BIGINT NOT NULL`
  - `logical_name VARCHAR(255) NOT NULL`（匹配用键，默认文件名小写或 URL basename）
  - `physical_name VARCHAR(255) NOT NULL`
  - `storage_path VARCHAR(512) NOT NULL`（如 `uploads/<userId>/<date>/<filename>`）
  - `mime VARCHAR(128)`、`size BIGINT`
  - `sha256 CHAR(64)`（去重）
  - `created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`
- 可选：`content_media_map`（若需要多对多精准映射）
  - `content_id BIGINT NOT NULL`、`media_id BIGINT NOT NULL`、`role ENUM('cover','image','video')`

## 文件存储策略
- 本地持久化路径：`app.getPath('userData')/uploads/<userId>/<YYYYMMDD>/`
  - Electron 主进程在确认后复制前端上传的 `File` 到上述目录；生成 `storage_path` 与哈希。
- 引用方式：
  - 解析表格中的“封面/配图”继续使用“逻辑文件名”做匹配；入库时将这些逻辑名解析为对应的 `media_files.id` 并存入 `cover_refs`/`image_refs`（存 `id` 数组或携带冗余 `logical_name`）。
- 视频文件同样落盘并记录 `video_ref` → `media_files.id`。

## 前端到后端流程
- 在自动发布视图点击“确认”后：
  1) 主进程 IPC `save-parsed-content` 接收：`rows`（解析数据）、`imagesMap`/`videoFiles`（文件集合）、`platform_code`、`type`。
  2) 主进程：
     - 将新文件写入 `userData/uploads/...`，计算 `sha256`，建立/复用 `media_files` 记录（哈希去重）。
     - 按行生成 `parsed_contents` 记录，并把封面/配图逻辑名映射到 `media_files.id` 存入 JSON 字段。
     - 返回生成的 `content_id` 列表与统计。

## IPC 接口
- `save-parsed-content(payload)`
  - 入参：`{ platformCode, type, rows, media: [{ logicalName, physicalName, blob }] }`
  - 出参：`{ ok, savedCount, contentIds, duplicates }`
- `list-parsed-content({ userId, platformCode?, type?, status? })`
- `get-content-detail({ contentId })`（含媒体关联）

## 校验与安全
- 文件名合法化，防路径穿越；写盘使用 `path.join`。
- 仅本地持久化，不外发到网络；后续可扩展 OSS 存储。
- 大小限制与类型白名单（图片：jpg/png/webp/gif；视频：mp4等）。

## 改动范围
- 主进程：新增 IPC 与落盘逻辑（`src/main.js`）。
- 数据库：在 `db/init.sql` 增加相关表与外键。
- 前端：自动发布视图在“确认”时调用 IPC，并在成功后提示“已保存到数据库”。

## 验证
- 解析 5 条图文与 1 条视频，确认入库成功，媒体文件在 `userData/uploads/...` 可见；`list-parsed-content` 能检索并渲染预览。

如果你确认采用本地持久化到 `userData/uploads` 的方案，我将开始实现数据库表、IPC 与入库流程。