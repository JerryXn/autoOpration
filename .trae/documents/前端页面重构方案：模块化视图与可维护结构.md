## 重构目标
- 明确页面职责：登录、平台选择、平台功能、自动发布各自独立，避免交叉耦合。
- 提升可维护性：拆分 renderer 逻辑为模块，统一路由与事件绑定，减少重复。
- 保持兼容：不改动已有 IPC 与权限设计，admin 仍跳过数据库授权。

## 当前结构与问题
- 单文件渲染：`src/renderer.js` 同时负责登录、平台、功能、自动发布，逻辑耦合；入口事件与状态分散（参考 src/renderer.js:47、62）。
- HTML 结构混杂：`src/index.html` 中多卡片叠加，显示/隐藏切换，长期维护困难（参考 src/index.html:26、38）。

## 目标架构
- 目录结构（保留现有文件，必要时新增少量模块）：
  - `src/renderer.js`：仅保留启动与路由初始化入口。
  - `src/views/login.js`：登录视图及校验与交互。
  - `src/views/platforms.js`：平台列表加载与进入功能页。
  - `src/views/ops.js`：平台功能列表与权限判断。
  - `src/views/autopublish.js`：自动发布（Excel/飞书）解析、图片匹配、预览、确认、导出。
  - `src/services/ipc.js`：封装 `window.api` 的调用（login/getUserPlatforms/getPlatformFeatures/openPlatform/fetchFeishu）。
  - `src/utils/xlsx.js`：Excel 模板生成、解析工具。
  - `src/utils/images.js`：图片名归一化、URL basename 提取、列表校验。
  - `src/styles/app.css`：样式集中管理，统一表格与按钮风格。

## 路由与视图生命周期
- 轻量路由：在 renderer 初始化一个 `Router`（内存路由），状态：`login`、`platforms`、`ops`、`autopublish`。
- 视图约定：每个视图导出 `{ mount(root), unmount() }`；路由切换时按约定挂载/卸载。
- 顶部返回键：依据当前路由决定返回目标（`autopublish`→`ops`；`ops`→`platforms`；`platforms`→`login`）。

## 权限与功能码
- 保持现有 `getPlatformFeatures`：在 `ops` 视图内根据功能码显示功能按钮（`publish_image_text`、`publish_video`）。
- admin 逻辑不变：在 `src/main.js:80` 与 `src/main.js:91` 已实现。

## 自动发布视图重构
- 组件化拆分：
  - 数据来源切换单选（Excel/飞书）。
  - Excel：模板下载、文件选择解析、图片文件选择与匹配。
  - 飞书：链接输入、抓取与解析（利用现有 `feishu-fetch` IPC）。
  - 预览表格：统一列与校验列，逐行缺失提示；导出与确认。
- 工具复用：
  - `utils/xlsx.js` 负责模板生成与解析。
  - `utils/images.js` 负责 `normalizeName`、逗号分割、对比校验。

## HTML 与样式
- 保留现有卡片结构，但视图通过 mount/unmount 控制可见性；减少直接 `style.display` 调用。
- 引入 `src/styles/app.css` 管理表格、按钮、提示色；从内联样式迁移。

## 错误处理与提示
- IPC 错误：飞书登录拦截返回明确文案（已在 `src/main.js:149`）。
- 解析错误：Excel/飞书统一提示框显示明细；“仅显示有问题行”筛选（后续增强）。

## 渐进交付
- 阶段 1：拆分 renderer 为视图与服务模块，完成路由与登录/平台/功能页迁移。
- 阶段 2：迁移自动发布逻辑到独立视图与工具模块，完成 Excel 与图片匹配、确认阻断与导出。
- 阶段 3：样式集中化与交互优化（筛选/排序、缩略图按需加载）。

## 验证与回归
- 保持现有入口与 IPC 行为不变；用现有账户流程验证功能未回归。
- 手动验证：使用模板与图片进行完整校验；飞书公开链接成功/失败分支。

## 需要确认
- 允许新增上述模块文件以提升可维护性。
- 功能码命名保持为 `publish_image_text` 与 `publish_video`。
- 样式集中到 `app.css`（不影响 Electron 安全设置）。
确认后我将按该计划开始重构。