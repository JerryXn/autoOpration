## 变更目标
- 立即发布与任务发布都不再直接修改数据库状态；只有在平台页面成功发布后，才将 `parsed_contents.status` 更新为 `published` 并写入 `published_at`。
- 对接你提供的小红书图文/视频发布页，自动填充、上传与标签点选，发布成功后回写；失败仅提示并保留“待发布”。

## 前端改动
- 发布列表“立即发布”按钮：
  - 点击后将当前行标记为“发布中…”（仅UI），禁用按钮，并调用新的 IPC：`start-web-publish(contentId)`。
  - 等待 IPC 返回：
    - 成功：显示统一成功 Toast（3秒自动消失），刷新列表（后端已将状态改为 `published`）。
    - 失败：弹框提示错误，行恢复为“未发布”，按钮恢复可用。
- 任务调度触发：前端不改，后端到点时调用同一发布流程。

## 后端改动（发布协调器）
- 新增 IPC：`start-web-publish`（参数：`contentId`）。
- 流程：
  1. 读取 `parsed_contents` 与 `media_files`，整合标题、正文、封面/配图/视频本地路径；读取平台与类型（例如 `xhs` + `image_text`/`video`）。
  2. 打开会话窗口（或复用现有窗口），导航到对应发布页：
     - 图文：`https://creator.xiaohongshu.com/publish/publish?source=official&from=menu&target=image`
     - 视频：`https://creator.xiaohongshu.com/publish/publish?source=official&from=menu&target=video`
  3. 自动选择器解析：识别标题输入、正文编辑区、标签输入与候选、上传控件、发布按钮等（生成主/备用选择器）。
  4. 人为操作模拟：随机停顿、鼠标悬停/点击、滚动、逐字键入；上传使用 DevTools Protocol 设置隐藏 `input[type=file]` 的文件路径。
  5. 标签处理：从正文或标签字段解析 `#标签` 列表，逐个输入，等待候选下拉并点选第一项；候选缺失回退 Enter；失败跳过并记录。
  6. 点击发布，等待成功判定：
     - 监测成功 toast 或弹层、按钮状态变化或页面路由跳转，命中任一即判成功。
  7. 成功后回写数据库：`UPDATE parsed_contents SET status='published', published_at=NOW() WHERE id=?`，返回 `{ok:true}`；失败返回 `{ok:false,error}`。
- 日志：步骤级日志与失败截图（本地保存），用于快速定位与迭代选择器。

## 任务发布改造
- 后端调度器到点时调用 `start-web-publish(contentId)`，而不是直接 `UPDATE status`；成功后写库，失败记录错误并不修改状态。
- 并发与去重：保留现有“当天时间点去重键”与平台并发限制，避免同时间重复发布。

## 成功/失败反馈统一
- 成功：前端显示统一 Toast（3秒），列表刷新显示“已发布”。
- 失败：前端弹框提示错误信息；行恢复为“未发布”。

## 安全与合规
- 不保存账号密码；仅在你登录的会话中自动化操作。
- 日志默认脱敏，不输出敏感文本或路径（可配置）。

## 验证流程（小红书优先）
1. 你登录小红书发布页（图文或视频）。
2. 在发布列表点击“立即发布”：自动填充–上传–标签点选–发布，成功后列表显示“已发布”。
3. 任务到点自动发布：同样流程，成功后写库；失败不改状态并提示。

如确认方案，我将落地：前端事件改造与新的 `start-web-publish` 协调器（含小红书图文/视频的选择器自动解析与发布执行），确保只有平台实际发布成功后才更新数据库状态。