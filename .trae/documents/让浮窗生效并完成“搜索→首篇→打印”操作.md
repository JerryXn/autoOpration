## 目标
- 自动执行失败时在浮窗明确提示：当前阶段、动作、原因（如找不到选择器、不可见、匹配为 0）、当前生效选择器与默认候选列表。你可以据此立即修改并重试。

## 诊断信息格式（浮窗显示）
- 字段：
  - `stage`：阶段名（如 `search_click`）
  - `action`：动作名（如 `query_selector`）
  - `reason`：`no_selector | no_match | not_visible | busy | restricted | navigation_blocked`
  - `selector`：当前生效的覆盖选择器（若无则空）
  - `defaults`：默认候选选择器数组（来自 `src/autoop/selectors.js`）
  - `tried`：本次尝试过的选择器列表
  - `matchCount`：匹配数量（整数）
  - `url`：当前页面 URL（便于判断受限或跳转）

## 实施方案
### 1. Runner 增强失败诊断（`src/playwright/runner.js`）
- 在 `perform()` 的各分支返回结构化结果并记录：
  - `query_selector/query_selector_next/program_click/search_click`：统计匹配数与 `tried`，未命中则 `reason: 'no_match'`；命中但不可见则 `reason: 'not_visible'`
  - 忙锁时：`reason: 'busy'`
  - 受限检测命中：`reason: 'restricted'`
- 将诊断对象通过：
  - 控制台：`console.warn('[pw-fail]', JSON.stringify(diag))`
  - 浮窗：调用 `window.__overlayFail(diag)`

### 2. 浮窗显示与辅助工具（`src/playwright/overlay.js`）
- 新增诊断面板区域：显示最近一次失败详情（上述字段）
- 提供辅助按钮：
  - “复制默认候选”→ 将 `defaults` 粘贴到选择器输入框
  - “高亮当前选择器”→ 在页面上为命中的第一个元素添加可视边框（通过 `__overlayHighlight` 注入样式）
  - “检测选择器”→ 调用 `autoopNative('validateSelector', { stage, selector })` 返回 `matchCount` 并高亮第一个
  - “重试下一步”→ 调用 `autoopNative('next')`
- 暴露接口：
  - `window.__overlayFail(diag)` 用于显示失败详情
  - `window.__overlayHighlight(selector)` 高亮匹配元素

### 3. 绑定新增命令（`src/playwright/index.js`）
- `autoopNative('validateSelector', { stage, selector })`：在页面中 `document.querySelectorAll(selector)` 返回数量；若数量>0则高亮第一个。
- `autoopNative('previewDefaults', { stage })`：显示该阶段默认集合，便于选择。

### 4. 默认候选回显（`src/autoop/selectors.js`）
- 保持默认集合作为单一来源；Runner 将 `defaults` 与 `tried` 一并回传浮窗。

### 5. 使用方式（你这边）
- 失败时浮窗会出现诊断面板：
  - 查看 `reason` 与 `tried/defaults`
  - 在输入框填入新选择器 → 点击“应用选择器”
  - 点击“检测选择器”确认 `matchCount>0`（页面会高亮第一个）
  - 点击“重试下一步”或再次“运行搜索”

### 6. 验证与预期
- 操作失败时浮窗即时显示原因和尝试过的选择器；你无需查看控制台即可定位问题。
- 修改选择器后重试，动作能继续推进直到打印首篇笔记内容。

### 7. 风险与回滚
- 诊断高亮仅加样式边框，对页面无破坏；若影响交互可一键清除样式。
- 如站点大改导致默认集合全部失效，仍可用“检测选择器”快速定位并覆盖。

确认后我将按以上方案实现 Runner 的诊断回传与浮窗的可视化提示。