## 目标
- 集成“任务发布”和“立即发布”的自动发布流程，取消人工确认。
- 适配小红书图文/视频发布页，自动填充标题/正文/媒体并处理标签（输入后点选第一个候选）。

## 技术方案
- 发布协调器（Orchestrator）：统一入口 `publishNow(contentId)` 与任务触发；根据 `platform+type` 调用适配器。
- 平台适配器（小红书）：自动解析并持久化选择器（主/备用），含：标题、正文、标签输入与候选、封面/配图/视频上传、发布按钮。
- 会话窗口：在你已登录的窗口中执行；不保存账号密码。

## 自动解析与填充
- 解析策略：语义邻近（“标题”“正文”“上传”“发布”“标签/话题”）、属性（placeholder/name/id/class）、事件（click/change/input）与布局位置综合打分。
- 填充：逐字键入标题/正文；媒体通过 DevTools Protocol 设置隐藏 `input[type=file]` 文件。
- 标签：从正文或独立输入中提取 `#标签`，输入后等待候选下拉并点选第一项；候选缺失时回退 Enter 确认；失败记录日志。

## 人为行为模拟
- 随机延迟（每步 300–1200ms，流程穿插 1–3s 停顿）。
- 鼠标移动/悬停/点击轻微抖动，滚动视图；逐字键入触发 `input/change`。

## 成功判断与回写
- 成功检测：发布成功 toast/弹层、按钮状态变化或页面跳转其中之一命中。
- 数据回写：成功后更新 `status='published'` 与 `published_at`，前端显示统一成功 Toast（3 秒自动消失）。

## 失败与回退
- 选择器未命中：尝试备用→语义重解析→保存截图与日志并返回错误。
- 上传失败：切换触发方式（按钮→隐藏 input→拖拽/剪贴板）；仍失败则跳过该媒体继续。
- 标签失败：候选未出现或点击失败回退 Enter；仍失败跳过并记录。

## 集成点
- 立即发布按钮：调用协调器自动执行→成功刷新列表。
- 任务发布：到点调用同一流程；登录态缺失时提示登录后继续。

## 日志与安全
- 步骤级日志与失败截图；默认脱敏，不记录账号密码或敏感数据。

## 验证步骤
1. 在你登录后，针对图文/视频发布页自动解析并生成选择器。
2. 用样例内容进行自动填充与上传、标签点选，直接自动发布。
3. 成功后列表显示为“已发布”，记录发布时间与日志；若失败，查看快照并调整选择器。