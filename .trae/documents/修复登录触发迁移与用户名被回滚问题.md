## 问题总览
- 登录与快捷登录在每次调用时执行 `runMigrations()`，重放 `db/auto_final.sql`，其中包含默认账号/角色/平台绑定等插入更新，导致手工改动被“回滚”。
- `ALTER TABLE ... ADD COLUMN IF NOT EXISTS` 在部分 MySQL 版本不支持，导致列未创建、后续更新失败。
- 代码库存在两套数据模型（`sys_*/op_*` 与旧的 `users/notes/...`），以及采集侧 Python 的删除重建操作，均有潜在数据覆盖风险。

## 目标
- 登录流程只读，不执行任何结构或数据写入。
- 迁移与种子解耦，迁移只在启动时按版本执行一次，种子只在缺失时执行并可关闭。
- 所有 DDL/DML 在执行前做存在性/幂等检查，兼容 MySQL 5.7/8.0。

## 方案
### 1. 迁移执行时机与方式
- 移除 `ipcMain.handle('login')` 与 `quick-admin-login` 中的 `runMigrations()` 调用。
- 在 `app.whenReady()` 初始化阶段执行一次迁移；增加 `sys_migrations` 版本表，采用“已应用版本”记录，仅执行未应用的迁移。
- 将 `db/auto_final.sql` 拆分为：`schema.sql`（仅 DDL）与 `seed.sql`（仅种子）；启动时默认只执行 `schema.sql`，`seed.sql` 由环境变量控制（如 `ENABLE_SEED=0` 在生产关闭）。

### 2. 消除不兼容的 DDL 与列检测
- 移除 `ALTER TABLE ... ADD COLUMN IF NOT EXISTS`；改为代码层在迁移中查询 `INFORMATION_SCHEMA.COLUMNS`，缺列时再执行 `ALTER TABLE ... ADD COLUMN display_name VARCHAR(128) NULL`。
- 视图创建继续采用“存在性检查后创建”的模式。

### 3. 默认数据种子改为幂等/可关闭
- 对 `sys_users` 的默认用户（`lv1_user/lv2_user/lv3_user`）改为逐用户存在性检查，不覆盖 `username` 的手工改动；默认在生产关闭该种子，仅保留 `admin`。
- 对 `sys_user_roles/sys_role_action_grants/sys_user_platforms` 的绑定与授权，逐条检查存在性后插入；不执行“覆盖式更新”。

### 4. 登录返回只读且使用显示名
- 登录查询统一使用：`SELECT id, username, COALESCE(display_name, username) AS display_name ...`；返回给前端的 `user.name` 使用 `display_name`。
- 快捷登录仅做 session 设置，不再写入任何角色/权限变更。

### 5. 统一库与模型
- 强制使用 `.env` 的 `MYSQL_DATABASE`（禁止默认回退到 `auto_operation`），防止错库。
- Node 与 Python 侧统一写入 `op_*`/`sys_*` 模型，清理或迁移旧的 `users/notes/...` 依赖，避免读写分裂。

### 6. 采集侧删除重建的风险缓解
- 将 `replace_images/replace_tags` 的 `DELETE+INSERT` 改为“差异更新”（比较现有与新集合，执行必要的删除/插入），并在事务中执行。
- 继续使用 `INSERT ... ON DUPLICATE KEY UPDATE` 的 upsert，避免盲目覆盖。

### 7. 防护与验证
- 在主进程为登录路径增加 SQL 采集器（只在开发），断言仅出现 `SELECT`。
- 增加集成测试：启动后登录检查数据库无新增/修改（对关键表计数与快照比对）。
- 脚本默认 `dry_run`，生产必须显式开启；为危险脚本添加环境白名单限制。

### 8. 数据修复
- 手动/迁移执行：`ALTER TABLE sys_users ADD COLUMN display_name VARCHAR(128) NULL AFTER username;`
- 按需设置显示名：`UPDATE sys_users SET display_name='lv1' WHERE username IN ('lv1','lv1_user');`
- 清理重复账号：若存在同时 `lv1` 与 `lv1_user` 两行，保留目标行；处理外键后删除冗余。

## 交付
- 修改主进程迁移调用与版本化迁移器；拆分 SQL 文件；更新登录查询；提供数据修复脚本与集成测试。请确认后我来实施具体改动并验证。