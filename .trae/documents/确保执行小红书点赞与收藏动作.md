## 问题判断
- 已登录并进入详情页，但未进入点赞/收藏执行分支或被中途打断；现有选择器和等待策略可能不足以在最新页面结构下稳定定位按钮。
- 需要让动作具备：更鲁棒的选择器集、显式等待、点击回退策略、执行状态校验，以及可配置化以适应页面变更。

## 改造目标
- 点赞/收藏在每次进入详情页后稳定执行；在失败时能明确定位原因；无需大量日志即可确认动作是否成功。

## 技术实现
### 1. 可配置选择器
- 在配置中新增 `cfg.xhs.detail_ui.like_selectors`、`cfg.xhs.detail_ui.collect_selectors`（数组）。
- 默认包含多组候选：
  - 点赞：`.like-lottie`, `button:has(.like-lottie)`, `.like-wrapper`, `[aria-label*="赞"]`, `button:has-text("赞")`, `button[aria-pressed]`
  - 收藏：`.collect-icon`, `button:has(.collect-icon)`, `svg.reds-icon.collect-icon`, `[aria-label*="收藏"]`, `button:has-text("收藏")`
- 代码优先使用配置中的选择器，再回退到内置列表。

### 2. 显式等待与可见性校验
- 在 `perform_like`/`perform_collect` 中：
  - `wait_for_selector`：对每个候选选择器依次等待（如 1.5–3s），要求 `visible`/`enabled`。
  - 若存在则 `.first.scroll_into_view_if_needed()` 并点击。
  - 无匹配则进入回退策略。

### 3. 回退点击策略
- DOM 回退：`document.querySelectorAll([...])` 合并候选，若找到图标或按钮：
  - `closest('button')` 优先点击；
  - `scrollIntoView({block:'center'})` 后 `dispatchEvent(new MouseEvent('click', {bubbles:true}))`。
- 坐标点击（最后兜底）：
  - 基于按钮元素的 `getBoundingClientRect()` 计算中心点并执行 `page.mouse.click(x, y)`。

### 4. 执行状态判定
- 计数判定：点击前后读取计数（不可用时为 `None`）。若 `after >= before` 则视为成功；若两者为 `None`，转为样式/属性判定。
- 样式/属性判定：
  - 点赞：按钮类名包含选中态（如 `liked`），或 `aria-pressed="true"`。
  - 收藏：存在选中态类（如 `collected`），或 `aria-pressed="true"`。
- 将最终 `status` 归一化为 `ok/fail`，并返回 `selected/strategy` 字段以便后续记录。

### 5. 动作触发时机与健壮性
- 在 `main_xhs.py` 的详情页循环中，确保：
  - 先 `feed_desc`，随后总是尝试动作（只受 `--like/--fav` 与 `dry_run` 控制）。
  - 动作执行异常不影响后续笔记处理；记录简要原因（不打印 SQL 成功类日志）。

### 6. 速率与人性化
- 结合 `cfg.humanize` 的点击延时；
- 基于现有 `limits`，在入口处按照 `perMin/perHour` 控制节奏，避免触发风控。

### 7. 最小化日志（保留关键）
- 仅保留：动作开始、最终结果（`status/before/after/selected/strategy`），失败时的简要错误；移除数据库成功类输出与“跳过”告警（已处理）。

### 8. 验证与回归
- 新增简单集成测试（本地账号登录后）：
  - 打开任意 `note_id` 的详情页，调用 `perform_like` 与 `perform_collect`，断言 `status == 'ok'` 或存在选中态属性。
- 提供命令：
  - `MYSQL_DATABASE=auto_test python -m auto_opration_python.src.main_xhs --like --fav --keyword=哈哈`
- 若目标页面结构变更，指导用户仅修改配置中的选择器即可适配。

## 涉及文件
- `auto_opration_python/src/automation/core/operator.py`：增强选择器使用、等待、回退及状态判定。
- `auto_opration_python/src/main_xhs.py`：确保动作触发、异常不阻塞、关键结果输出。
- `auto_opration_python/src/automation/config/models.py` 与默认配置：新增 `detail_ui` 选择器配置。
- 测试：`auto_opration_python/tests/test_like_collect_click.py` 补充选择器与状态断言。

## 交付结果
- 点赞与收藏在真实页面上稳定执行；失败时给出可定位的原因；通过配置即能快速适配页面变动；终端输出简洁可读，仅含关键动作信息。

## 需要你的确认
- 是否按上述方案实现并推送改动；如需特定页面的额外选择器（你提供示例 DOM 片段），我可以同时加入到默认列表，提升命中率。