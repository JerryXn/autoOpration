## 日志分类与级别
- 类别：
  - [数据库]：连接、事务、增删改查（SELECT/INSERT/UPDATE/DELETE）及影响行数、错误
  - [操作]：浏览器与页面操作（导航、登录、点击、输入、滚动、定位、回复提交等）
  - [远程调用]：外部服务接口调用（AI生成、消息列表、第三方API）
- 级别：`info`（阶段进度与成功）、`warn`（风险与重试）、`error`（失败与异常）。
- 结构（统一JSON键）：
  - `类别`：[数据库/操作/远程调用]
  - `级别`：[info/warn/error]
  - `动作`：[连接/事务开始/提交/执行SQL/请求/响应/点击/输入/提交/入库开始/入库成功/入库失败]
  - `说明`：一句话阐明此步的目的
  - `入参`：关键入参（Authorization脱敏、payload/text截断）
  - `返回`：关键返回（HTTP状态、文本头、JSON关键字段、影响行数）
  - `标识`：上下文标识（note_id/comment_id/keyword/page/cursor/reply_id等）

## 实施改动
### Python日志工具
- 新增轻量日志函数（可直接内嵌）：`logf(类别, 级别, 动作, 说明, 入参=None, 返回=None, 标识=None)`，统一输出结构化JSON。
- 在各模块调用该函数，替换零散与无意义日志。

### 数据库层（src/storage/mysql_client.py）
- [数据库] `info`：连接成功、事务开始/提交/回滚、执行SQL成功（语句摘要≤400、参数、影响行数）
- [数据库] `error`：执行失败（语句摘要、参数、错误信息）；
- [数据库] `warn/silent`：若错误消息包含“Truncated incorrect”→输出`warn`并静默（不抛出）；其他错误抛出异常。

### 入库封装（src/storage/xhs_repo_mysql.py）
- 在 `store_comment_reply` / `store_comment_reply_response` 前后：
  - [数据库] `info` 入库开始（表、字段摘要、note_id/comment_id/reply_id）
  - [数据库] `info` 入库成功（影响行数/reply_id）
  - 失败时由 mysql_client 捕获并输出 [数据库] `error`。

### 远程调用（src/invoke/remote_invoke.py）
- [远程调用] `info` 请求：URL、脱敏Authorization（前缀+后缀+长度）、Content-Type、payload_head、timeout_ms。
- [远程调用] `info` 响应：HTTP状态、text_head、JSON关键字段（chat_id/conversation_id、data_count）。
- [远程调用] `error`：凭据缺失、HTTP非200；
- URL过滤：支持 `.env: LOG_IGNORE_URLS`，默认忽略你指定的message_list URL。

### 页面与业务操作（src/invoke/comment_pipeline.py）
- [操作] `info` 评论筛选：raw/cleaned摘要、keep布尔；标识包含 note_id/page/index。
- [操作] `info` 回复提交：content_head、返回status/text_head、标识 note_id/comment_id。
- 入库阶段：上移到入库封装日志中，确保“先入库后继续”；跳过路径（AI返回false）也写入一条status=skipped并记录。

### 主进程展示（src/main.js）
- 解析结构化JSON：读取 `类别` 与 `级别`，行首打印“[类别] 动作 级别”，颜色映射：
  - `info`→绿色、`warn`→黄色、`error`→红色；
- 去除无意义日志：仅显示结构化日志；保留凭据健康检查为 [远程调用] `info`（COZE_TOKEN/COZE_BOT_ID掩码）。

## 验证
- 执行一次评论流程，观察关键链路：
  - [远程调用] 请求→响应（含chat_id/conversation_id与answer摘要）
  - [操作] 提交回复（content_head、status）
  - [数据库] 执行SQL与入库成功（影响行数/reply_id）
  - 出现错误时为红色 [数据库]/[远程调用] `error`；截断为灰/黄（静默处理）。
- 数据库 `auto_final`：`xhs_comment_replies`、`xhs_comment_reply_responses` 记录增长，与日志中的reply_id对应。

## 交付
- 引入统一日志函数并逐点替换；完善数据库、操作、远程调用的中文结构化日志；保留URL过滤与截断容错，移除无意义输出。