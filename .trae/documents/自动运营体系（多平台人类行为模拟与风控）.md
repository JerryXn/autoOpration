## 目标
- 在已登录的会话窗口内，对不同平台的图文/视频内容执行“浏览、点赞、收藏、评论、记录浏览信息”等自动运营操作。
- 操作全程模拟人类行为，并融合平台风控与频率控制；失败时自动重试或回退。
- 基于页面可观测能力（DOM/UI/AX/Mutation/事件/网络）自动生成选择器并自我校正。

## 架构
- Orchestrator（协调器）：统一入口 `startAutoOp(config)`/`stopAutoOp(runId)`，按平台+类型路由至适配器；维护队列、并发、配额与节流。
- Adapter（平台适配器）：每个平台/类型定义动作序列（浏览/点赞/收藏/评论），依赖选择器生成器；可热更新。
- Inspector（页面采集）：CDP启用 DOM/DOMSnapshot/AX/Runtime/Log/Network/PerformanceTimeline；注入 MutationObserver 与事件监听钩子；输出快照与差异。
- Action Runner（行为执行）：CDP Input/DOM/Runtime；封装鼠标移动/悬停/滚动/点击、键盘输入、视口变化与随机停顿。
- MCP Client：HTTP 客户端，评论开关开启时读取评论并请求远程 MCP 返回回复内容（后续补充具体接口）。

## 数据与IPC
- 新增 IPC：
  - `start-auto-op`：启动自动运营（入参 `platform,type,keywords,actions,limits`）。
  - `stop-auto-op`：停止指定运行。
  - `list-auto-op-runs`：查询历史与当前运行状态。
- 表与记录（后端持久化）：
  - `auto_ops`：配置模板（平台、类型、关键词、动作、限额）
  - `auto_op_runs`：一次运行实例（开始/结束、结果、统计）
  - `auto_op_events`：细粒度事件（时间、动作、目标、结果、耗时、错误快照路径）
- 日志与快照：
  - `userData/inspect/<timestamp>/<platform-type>/`：树与事件快照
  - `userData/publish_logs/`：失败截图与日志（已接入保留策略）

## 前端UI
- 自动运营页面：
  - 平台与类型选择：`platform`（如 xhs/douyin）+ `type`（image_text/video）
  - 关键词搜索：输入框与标签，支持多关键词
  - 操作勾选：浏览、点赞、收藏、评论、记录浏览信息
  - 限制设置：
    - 数量：每次运行的最大条数、每日上限
    - 频率：每分钟/每小时上限、随机停顿范围、操作间隔
    - 风控：并发=1、冷却时间、失败重试次数
  - 评论开关：开启后显示 MCP 地址与鉴权配置（内容生成后续接入）
  - 运行状态：当前步、已完成数、失败数、最近错误、查看快照/日志按钮

## 行为模拟与风控
- 人类行为：
  - 随机延迟：300–1200ms 步骤延迟，1–3s 阶段停顿
  - 鼠标：移动→悬停→点击（轻微抖动），随机滚动与停留
  - 视口：宽高变化、滚动到元素附近、逐步滚动
  - 键盘：逐字键入、回车确认、Tab/ShiftTab 切换
- 风控策略：
  - 并发：同平台单窗口串行（并发=1）
  - 配额：每日/每小时/每次运行上限；触发上限立即停止
  - 节流：固定+随机间隔，指数退避在错误或检测到风控时
  - 多样化：操作路径随机化（不同按钮/不同滚动偏移），行为插入无害动作（查看详情、返回）
  - 指纹：避免恒定时序与恒定路径；插入微抖动与不同停顿分布

## 适配器动作序列（示例：小红书 图文）
- 搜索：定位搜索输入→输入关键词→回车→等待结果列表→滚动加载
- 浏览：按策略进入若干条目→停留若干秒→滚动评论区→返回
- 点赞：定位点赞按钮→悬停→点击→验证点赞态
- 收藏：定位收藏按钮→点击→验证收藏态
- 评论：打开评论区→读取最新 N 条评论→对每条触发 MCP→填入回复→点击发送→验证成功
- 记录：为每个操作写入 `auto_op_events`，含元素选择器、文本、截图、耗时、成功/失败

## 选择器生成与自校正
- 生成：语义邻近（中文文案“点赞/收藏/评论/搜索”）、属性（aria/role/placeholder/name/id/class）、事件绑定与位置权重；输出主+备选择器。
- 自校正：命不中或失败触发重分析；尝试备选与相对选择器；仍失败记录快照与错误并跳过。

## 评论与MCP（占位）
- 流程：
  - 读取评论文本与上下文（作者昵称、时间等）
  - 通过 HTTP 请求 MCP 服务返回回复文本（URL/鉴权从UI配置）
  - 写入回复并点击发送，记录结果
- 失败处理：MCP不可用时跳过评论并记录；频繁失败触发冷却

## 运行与停止
- 启动：
  - 创建/复用平台窗口→导航到入口/结果页→Inspector采集→按动作序列执行
  - 达到上限或风控信号立即停止
- 停止：
  - 前端点击“停止”或达到配额/风控条件
  - 关闭队列与窗口、写入运行总结

## 验证
- 从小红书图文开始，执行“关键词搜索→浏览→点赞→收藏→评论（MCP占位）→记录”。
- 查看事件日志与快照；失败时检查选择器与回退是否生效。

## 安全
- 不保存账号密码；所有操作在用户已登录窗口中完成。
- 日志脱敏，不输出敏感数据；本地保留策略已启用（1天/500MB）。

如确认，我将按以上架构添加后端 IPC 与 Orchestrator/Inspector/Runner骨架、前端配置面板与运行状态视图，先打通小红书图文的“浏览/点赞/收藏/评论（占位）”全链路，再扩展到其他平台与类型。