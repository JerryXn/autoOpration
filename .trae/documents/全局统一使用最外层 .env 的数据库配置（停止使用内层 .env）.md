## 问题定位
- Python 项目仍在写入 `opration_data`，说明其数据库选择逻辑存在默认值或优先级问题（优先用内部 YAML/内层 .env/默认值），未严格采用外层 .env。
- 现状：主进程已将外层 `.env` 透传到 Python 子进程，但 Python 内部仍可能读取 `auto_opration_python/.env` 或使用默认值 `opration_data`。

## 统一策略（只用最外层 .env）
- 数据库配置统一从进程环境变量读取：`MYSQL_HOST`、`MYSQL_PORT`、`MYSQL_USER`、`MYSQL_PASSWORD`、`MYSQL_DATABASE`。
- 停止在 Python 项目中读取 `auto_opration_python/.env`；若需 Bot/AI 配置（如 `COZE_BOT_ID`），也改为从进程环境变量读取，允许将该变量搬到最外层 `.env`。
- 移除任何回退到 `opration_data` 的默认逻辑；数据库名必须来自环境变量，未提供则报错并记录。

## 代码改造点（Python）
- 入口与流程：
  - `src/main_xhs.py`：数据库配置读取改为仅从 `os.environ`；在连接前输出“effective db=...”。
  - `src/user_flow_xhs.py`：同样改为从环境变量读取数据库名；删除 `database=... or 'opration_data'` 的后备。
- 存储层：
  - `src/storage/mysql_client.py`：若有参数默认值，移除默认数据库名；必须由调用方传入环境值。
  - `src/storage/xhs_repo_mysql.py`：删除或禁用任何创建 `opration_data` 的 DDL；严禁隐式建库。
- 配置读取：
  - 移除或停用对 `auto_opration_python/.env` 的加载逻辑（如有）；统一改为从进程环境读取。
  - 对 AI 配置（如 `COZE_BOT_ID`）统一从环境读取；需要时我们将该键从内层 .env 迁移至外层 .env。

## 主进程与运行
- `src/main.js`：spawn Python 时继续透传外层 `.env` 的全部变量，不再向子进程注入任何其他数据库变量；在 spawn 前打印 `MYSQL_*` 值以便核对。

## 验证与日志
- 启动时打印：
  - Node：`[start-auto-op] MYSQL_DATABASE=...`
  - Python：`connect info database=...`（应为 `auto_final`）。
- 运行后在 MySQL 执行：`SELECT DATABASE();` 确认为 `auto_final`；并检查写入：`SELECT COUNT(*) FROM notes;`、`requests_log;`、`xhs_comment_replies;`。

## 迁移与清理
- 将 `auto_opration_python/.env` 中必须的键（如 `COZE_BOT_ID`）搬到最外层 `.env`；内层 .env 不再读取。
- 保留现有 `db/global.sql` 与 `scripts/migrate_auto_final.js` 用于结构兼容；如历史结构不同，继续按该脚本修正到统一模型。

## 交付
- 更新 Python 入口、流程和存储层的配置读取与默认值移除；
- 停用内层 .env，统一从外层 .env 读取；
- 增加“生效数据库名”日志；
- 完成端到端验证，确保只写入 `auto_final`。