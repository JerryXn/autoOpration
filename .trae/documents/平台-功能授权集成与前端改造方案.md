## 目标
- 登录后按“平台-功能授权”动态显示可选平台与其功能按钮
- 点击“开始执行”进入对应平台的浏览器窗口（如小红书/抖音）
- 创建两个演示账户：
  - xhs_user：仅授权小红书平台
  - douyin_user：仅授权抖音平台

## 后端改造（主进程）
- 新增 IPC 接口（src/main.js）：
  1) `getUserPlatforms(userId)`：查询用户拥有的平台
  2) `getPlatformFeatures(userId, platformCode)`：查询用户在指定平台拥有的功能
  3) `openPlatform(platformCode)`：打开窗口并跳转到对应平台首页
- 查询逻辑（使用现有表）：
  - 平台列表：`user_platforms`→`platforms`
  - 功能列表：`user_feature_grants`→`platform_features`→`features`
- 登录逻辑保留现有有效期校验；返回 `userId` 用于后续查询

## 预加载与渲染进程桥接
- `src/preload.js` 暴露：
  - `login(username, password)`
  - `getUserPlatforms()`（登录成功后调用）
  - `getPlatformFeatures(platformCode)`
  - `openPlatform(platformCode)`
- 所有接口通过 `ipcRenderer.invoke` 与主进程交互

## 前端页面改造（首页）
- 页面状态：
  1) 登录卡片（已有）
  2) 平台选择区：登录后拉取平台列表，显示为单选或卡片列表
  3) 功能区：选定平台后拉取功能列表并显示按钮（发布、自动运营）
  4) 执行入口：保留“运行程序”或按功能按钮动态触发，最终调用 `openPlatform(platformCode)`
- 交互流程：
  - 登录成功→加载平台列表→用户选择平台→加载平台功能→展示功能按钮→点击触发
- UI 文件改动：
  - `src/index.html`：新增平台与功能区域结构
  - `src/renderer.js`：新增状态管理与 IPC 调用，基于选择动态渲染

## 平台跳转映射
- 在主进程维护平台跳转映射：
  - `xhs → https://www.xiaohongshu.com/`
  - `douyin → https://www.douyin.com/`
  - `ks → https://www.kuaishou.com/`
  - `mp → https://mp.weixin.qq.com/`

## 创建两个演示账户与授权
- 账户创建（使用现有 `npm run user:add` 脚本）：
  - `U=xhs_user P=pass123 E='2026-01-01 00:00:00' npm run user:add`
  - `U=douyin_user P=pass123 E='2026-01-01 00:00:00' npm run user:add`
- 授权（新增两条授予命令，计划添加 npm 脚本）：
  - 授予平台：向 `user_platforms` 写入 `user_id`-`platform_id`
  - 授予平台功能：向 `user_feature_grants` 写入 `user_id`-`platform_feature_id`
- 我将添加两个脚本：
  - `grant:platform`：参数 `U`、`PLAT`（如 `xhs`/`douyin`），自动查 ID 并插入 `user_platforms`
  - `grant:feature`：参数 `U`、`PLAT`、`FEAT`（如 `publish`/`auto_operation`），自动查 `platform_features.id` 并插入 `user_feature_grants`
- 执行示例：
  - `U=xhs_user PLAT=xhs npm run grant:platform`
  - `U=xhs_user PLAT=xhs FEAT=publish npm run grant:feature`
  - `U=xhs_user PLAT=xhs FEAT=auto_operation npm run grant:feature`
  - `U=douyin_user PLAT=douyin npm run grant:platform`
  - `U=douyin_user PLAT=douyin FEAT=publish npm run grant:feature`
  - `U=douyin_user PLAT=douyin FEAT=auto_operation npm run grant:feature`

## 验证步骤
- 启动应用，使用 `xhs_user / pass123` 登录：应显示平台列表仅包含“小红书”；选中后显示功能按钮“发布”“自动运营”
- 使用 `douyin_user / pass123` 登录：应显示平台列表仅包含“抖音”；选中后显示对应功能按钮
- 点击功能或“运行程序”应打开对应平台网页

## 交付内容
- 后端：新增 IPC 服务与平台映射
- 预加载：暴露新接口
- 前端：平台选择与功能列表 UI 与逻辑
- 脚本：`grant:platform` 与 `grant:feature`，以及执行示例

确认后我将开始实施上述代码改动，并创建两个账户及授权。