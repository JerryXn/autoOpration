## 目标
- 取消人工确认，全流程自动发布（任务触发与“立即发布”均自动执行）。
- 支持小红书图文/视频发布页的内容填充、文件上传、标签输入并点选第一个候选项。
- 自动选择器解析，稳定命中标题/正文/上传/标签/发布按钮。

## 发布流程（通用）
1. 打开发布页：根据平台与类型选择 URL（图文/视频）。
2. 等待登录态（若未登录由你完成登录），页面 `domcontentloaded`/主要区域可见。
3. 自动解析选择器（标题、正文、封面/配图或视频上传、标签输入、候选列表、发布按钮）。
4. 填充与上传：
   - 标题：逐字插入；随机停顿与鼠标悬停。
   - 正文：富文本容器插入（纯文本为主）；保留原有表情/段落。
   - 媒体：通过隐藏 `input[type=file]` 使用 DevTools Protocol 设置真实文件路径；图文上传封面与配图，视频上传视频与封面（若平台需要）。
5. 标签处理：
   - 从正文或独立字段中提取 `#标签` 序列（按出现顺序去重）。
   - 对每个标签：
     - 聚焦标签输入框→依次插入 `#`+标签文本。
     - 等待候选下拉出现（如 `ul/li` 列表或弹层）→点选第一个候选项。
     - 若未出现候选：回退为按下 `Enter` 确认；若依旧失败则跳过该标签并记录日志。
     - 两个标签之间加入随机延迟（300–1200ms），并在列表区域进行一次鼠标移动与轻微滚动。
6. 发布：点击发布按钮→等待成功提示或路由变化；成功后回写数据库 `status='published'`、`published_at`；失败记录错误（含截图）。

## 选择器自动解析
- 策略：
  - 语义邻近：“标题/正文/上传/发布/标签”等中文文本的近邻节点；`placeholder`、`aria-label`、`name/id/class`包含关键词。
  - 事件绑定：节点是否绑定 `click/change/input`；隐藏 `file` input 的触发按钮。
  - 布局位置：主发布区域与固定容器层级（如右侧工具栏/底部操作区）。
- 产出：每类元素生成主选择器 + 2–3个备用选择器（CSS/XPath/相对路径），持久化到适配器配置（图文/视频各一份）。

## 人为操作模拟
- 随机延迟：每步 300–1200ms、流程 1–3s 长停顿。
- 鼠标：移动→悬停→点击（带抖动）；滚动视图；在输入前后微调焦点。
- 键盘：逐字插入；必要时触发 `blur`/`change` 来促使平台校验。

## 成功判断与回写
- 成功判定：
  - 页面出现“已发布/发布成功”的 toast 或弹层；或按钮变为“已发布”；或跳转到列表页。
  - 至少命中其一即判成功。
- 回写：成功后更新数据库并刷新前端列表；统一成功 Toast（3秒自动消失）。

## 失败与回退
- 选择器未命中：尝试备用选择器→重跑语义解析→若仍失败，保存截图并返回错误。
- 上传失败：切换上传方式（直接文件设定/触发按钮/拖拽区域），必要时跳过该媒体并继续发布其他内容。
- 标签失败：无候选或点击失败时，使用 `Enter` 确认；仍失败则跳过该标签并记录。

## 集成入口
- 立即发布按钮：调用协调器，自动执行完整流程并刷新列表。
- 任务发布（到点）：触发同一流程；若登录态缺失则提示登录并暂停该任务直至登录完成后重试。

## 日志与可观测性
- 步骤级日志：选择器命中、上传结果、标签候选点击情况与时延。
- 失败截图：保存当前视图以便复盘。
- 成功提示：统一 Toast（3秒自动消失）。

## 安全
- 不保存账号密码；所有操作在用户已登录窗口中完成。
- 文件路径仅用于上传；日志默认脱敏。

## 验证路径（小红书优先）
- 图文/视频各跑一次：解析→填充→上传→标签点选（默认选第一项）→自动发布→列表刷新。
- 若标签候选结构变动，适配器加入备用选择器并重试。