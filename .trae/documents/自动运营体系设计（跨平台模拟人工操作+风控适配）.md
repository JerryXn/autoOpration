## 目标

* 在各平台网页中模拟人工的浏览、点赞、收藏、评论、记录浏览信息等操作，支持类型（图文/视频）与关键词搜索。

* 深度结合“页面可观测与选择器自生成体系”，动态解析页面结构并自适应选择器，严格遵循平台风控策略。

* 提供可配置的次数/频率限制与启停开关；评论开启后通过 HTTP 调用 MCP 完成自动回复（接口稍后接入）。

## 能力复用

* 解析采集：复用 DOM/UI/AX 树、Mutation/事件钩子、Network/Console 的采集能力；失败自动重分析与回退选择器。

* 行为模拟：复用随机停顿、鼠标移动/悬停/点击抖动、滚动、逐字键入、视口切换、元素可见性等待。

* 保留策略：日志/快照/截图按 1 天、500MB 管控。

## 架构设计

* Orchestrator（运营协调器）：根据 `platform+feature`（browse/like/favorite/comment）编排步骤，管理会话、限速、失败重试、风控信号与数据回写。

* Adapter（平台适配器）：按平台与内容类型提供入口页/搜索页 URL、核心位点（搜索框、列表、项操作区、评论区）的主/备选择器与动作脚本。

* Inspector（页面分析器）：进入目标页后采集树数据与事件，生成/更新选择器；输出证据（命中截图+节点边界）。

* RateLimiter（限速器）：平台级与功能级 Token Bucket（例如每分钟 X 次、每小时 Y 次、每日 Z 次）；支持随机抖动与冷启动节流。

* RiskGuard（风控守卫）：捕获异常提示/验证码/失败返回；遇到风控信号触发降速、暂停或切换策略；记录风险事件。

* Recorder（记录器）：写入操作日志、截图、页面快照与结构化运营数据（浏览轨迹、互动结果）。

## UI 配置与参数

* 平台选择与类型：`platform`（xhs/douyin/mp/ks…）、`contentType`（image\_text/video）。

* 关键词搜索：关键字列表、搜索来源（站内/话题/用户）。

* 操作开关：浏览（必选）、点赞、收藏、评论、记录浏览信息（必选）。

* 次数/频率：

  * 每分钟/每小时/每日上限（可分别配置）。

  * 单次行为节奏：最小/最大停顿（ms）、页面停留时长（s）。

* 评论开关：启用后设置 MCP HTTP 地址、鉴权 Header、评论策略（回复条数、是否仅回复含关键词的评论、是否 @ 作者）。

* 其他：黑/白名单（作者/话题/关键词）、工作时段（如 9:00–23:00）、并发窗口（单会话串行、跨平台隔离）。

## 人为操作模拟策略

* 进入页与搜索：

  * 跳转入口页，等待主容器可见；关键词逐字输入，触发搜索；滚动加载。

* 列表浏览：

  * 随机滚动、停顿、首屏与次屏来回；进入详情页停留；返回列表。

* 点赞/收藏：

  * 元素可见性确认→鼠标移动→悬停→点击；与浏览动作交叉执行；加入失败重试与备选选择器。

* 评论：

  * 展开评论区→读取若干评论→触发 MCP（HTTP）获取回复文本（后续接入）→逐字键入→发送→滚动确认已发送；

  * 加入随机延迟、插入表情或轻微文本扰动；避免高频重复模板。

* 记录：

  * 采集标题/作者/话题/时间戳/点赞数/评论数/是否已互动/页面 URL；存入本地数据库或 JSON。

## 风控适配与回退

* 风控信号：验证码弹窗、操作频繁提示、需要实名认证/绑定手机、按钮不可点击/灰显、接口 4xx/429/5xx。

* 处理策略：

  * 轻度：降速（扩大停顿）、延迟下一次互动、改为仅浏览。

  * 中度：暂停当前平台 30–120 分钟；保留状态，待人工干预。

  * 重度：终止任务并标记需人工处理；保存截图与日志。

* 指纹与一致性：保持用户会话、UA/语言/时区一致；避免同时触发多平台互动；限制夜间操作。

## 任务编排与限速

* 任务：由关键词与操作集合组成的“运营脚本”，支持循环与权重分配。

* 限速：平台级与功能级双层 Token Bucket；任务维度冷却时间与失败背压（指数退避）。

* 调度：按工作时段与上限执行；支持“立即执行”与周期执行；任务状态（pending/running/paused/failed/completed）。

## 评论回复联动（先预留）

* 读取评论：采集评论列表文本与作者 ID、时间；过滤策略（含关键词/长度/情绪）。

* HTTP 调用 MCP：`POST /reply`（待你提供）携带上下文（标题、正文摘要、评论文本）；返回回复文本。

* 发送回复：逐字键入与轻微扰动（随机表情/换行）；插入停顿；失败重试。

## 采集与日志

* 采集包：`inspect/<ts>/<platform-type>/dom.json、snapshot.json、ax.json、mutations.json、events.json、network.json、console.log、evidence.png`。

* 运营日志：每次互动写入结构化 JSON（含选择器、证据截图、用时、结果、风控信号）。

* 前端面板：实时显示任务状态与错误详情，一键打开控制台与下载日志包。

## 数据模型（示例）

* `operation_runs(id, platform, type, keyword, action, status, started_at, finished_at, metrics_json, logs_path)`。

* `operation_events(run_id, step, selector, success, duration_ms, evidence_path, message)`。

## 安全与合规

* 不保存账号密码；仅在用户已登录窗口内操作。

* 日志默认脱敏；不输出敏感文本内容；保留策略按 1 天/500MB。

## 验证路线

* 以小红书为首个平台：关键词“图文/视频”各做一条完整链路（搜索→浏览→点赞/收藏→评论（占位）→记录）。

* 在面板观察风控信号，调整节奏与选择器；失败保存快照与证据。

* 通过 3–5 次连续运行评估稳定性与被动风控触发率。

## 后续扩展

* 平台适配：抖音/快手/公众号等；按类型配置入口与选择器。

* 评论策略：接入 MCP 后完善基于上下文的自动回复模板与节制策略。

* 反探测增强：更多人类行为特征（视线模拟、滚动惯性、停留时长分布）。

