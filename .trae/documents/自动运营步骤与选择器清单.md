## 总览
- 平台：小红书（`https://www.xiaohongshu.com/`）
- 执行入口：`src/main.js:108`（`start-auto-op`）
- 阶段推进：`src/main.js:549-557`（状态机）
- 队列定义：`src/autoop/steps.js:1`（每阶段动作）
- 默认选择器：`src/autoop/selectors.js:1`（集中管理）
- 运行时覆盖：渲染浮窗设置选择器，主进程接收并生效 `src/main.js:576`

## 步骤清单（类型 + 描述 + 选择器）
1. 操作｜打开网页
   - 描述：打开探索页 `https://www.xiaohongshu.com/explore`
   - 选择器：无（直接导航）
2. 操作｜点击搜索框（阶段：`search_focus`）
   - 描述：定位搜索输入框，鼠标移动与点击聚焦
   - 选择器：
     - `input[placeholder*="搜索"]`
     - `input[type="search"]`
     - `input[aria-label*="搜索"]`
     - `input`
3. 操作｜输入关键字（阶段：`search_input`）
   - 描述：将关键字逐字符注入到输入框（键盘事件）
   - 选择器：同上（搜索输入框集合）
4. 操作｜点击搜索按钮（阶段：`search_click`）
   - 描述：定位按钮并点击；无按钮时回退按 `Enter`
   - 选择器：
     - `button[aria-label*="搜索" i]`
     - `button[type="submit"]`
     - `button`
     - `[role="button"]`
     - `[type="submit"]`
     - 文案兜底：`/搜索|Search/`（在所有按钮中匹配）
5. 操作｜打开列表第一项（阶段：`browse_list`）
   - 描述：在列表页定位候选卡片或链接，点击打开
   - 选择器：
     - `a[href^="/explore/"]`
     - `a[href*="/explore/"]`
     - `a[href*="/discovery/item"]`
     - `[role="link"] a[href*="/explore/"]`
     - `.note-item a[href*="/explore/"]`
     - `.feeds a[href*="/explore/"]`
     - `[data-note-id], .note-item, article[role="article"]`
6. 操作｜进入详情（阶段：`open_item`）
   - 描述：优先用鼠标事件点击元素中心，失败回退 DOM `click()`
   - 选择器：
     - `a[href^="/explore/"]`
     - `a[href*="/discovery/item"]`
7. 操作｜受限检测（阶段：`detect_restricted`）
   - 描述：检测页面是否为“当前笔记暂时无法浏览/返回首页”或 URL 含 `/404?`
   - 选择器：文案检测（遍历 `body *` 元素文本），无固定 CSS 选择器
8. 操作｜返回列表（阶段：`back_to_list`）
   - 描述：点击“返回首页”或执行 `history.back()`
   - 选择器：在 `a,button` 中匹配文案 `/返回首页/`
9. 操作｜打开下一候选（阶段：`open_next_item`）
   - 描述：在列表页选择未访问过的下一条并点击
   - 选择器：
     - `a[href*="/explore/"]`（过滤 `visited` 集合）
10. 获取数据｜采集详情页信息（阶段：`browse_detail`）
    - 描述：解析 URL、笔记 ID、标题、作者、图片等，并入库
    - 选择器：
      - 标题：`h1,h2,[data-title]`
      - 作者链接：`a[href*="/user/profile"], [data-author], .author a`
      - 图片：`img`
    - 数据写入：`upsertPlatform/Creator/Note/NoteMedia`、`insertBrowseSession/NoteVisit`（见 `src/main.js:292-446`）
11. 操作｜返回列表并选择下一条（[循环]）
    - 描述：完成详情后返回列表，选择下一条继续（受限则走回退链）
    - 选择器：同第 9 条

## 循环标注
- 关键词循环：[循环] 对 `keywords` 列表逐个执行步骤 2–11（`src/main.js:163-448`）
- 列表内连续浏览：[循环] 在 `open_next_item → open_item → detect_restricted → ...` 链路上按未访问集合推进

## 覆盖与修改方式
- 运行时覆盖：在浮窗中选择阶段并输入选择器 → “应用选择器”（`src/views/autoop.js:66-76`）
- 主进程接收：`ipcMain.on('autoop-set-selector', ...)`（`src/main.js:576`）；优先使用你设置的选择器，其次使用默认集合（`src/autoop/selectors.js:1`）

## 关键代码位置
- 队列生成与入口：`src/autoop/steps.js:1`、`src/main.js:150`、`src/main.js:532-539`
- 单步执行器（动作实现）：`src/main.js:454-561`
- 默认选择器集合：`src/autoop/selectors.js:1`
- 详情采集与入库：`src/main.js:292-446`

如需我把这份清单展示在 UI 浮窗侧栏，支持“查看当前生效的阶段选择器 + 一键恢复默认”，可以继续实施。