# Playwright 自动化平台操作手册

本手册将指导您如何使用本平台进行脚本的录制、管理和执行。

## 1. 准备工作

在执行任何操作之前，请确保主控服务（Orchestrator）已经启动。这是一个常驻服务，负责管理所有的任务。

**启动主控服务：**
打开一个终端窗口，运行：
```bash
npm start
```
> 保持该窗口开启，不要关闭。如果看到 `orchestrator listening on http://localhost:3000`，说明启动成功。

---

## 2. 查看脚本列表

要查看当前系统中已有的脚本，请打开一个新的终端窗口，运行：

```bash
npm run cli -- list
```

**输出示例：**
```
┌─────────┬──────────────┬──────────┐
│ ID      │ Name         │ Entry    │
├─────────┼──────────────┼──────────┤
│ example │ Example Demo │ index.js │
└─────────┴──────────────┴──────────┘
```

---

## 3. 录制新脚本

如果您需要创建一个新的自动化脚本，可以使用录制功能。

**命令格式：**
```bash
npm run record <目标URL> <脚本名称>
```

**示例：**
录制一个打开百度的脚本，保存为 `baidu-test`：
```bash
npm run record https://www.baidu.com baidu-test
```

**操作步骤：**
1.  运行命令后，会弹出一个浏览器窗口。
2.  在浏览器中进行您的操作（点击、输入等）。
3.  操作完成后，关闭浏览器窗口或在终端按 `Ctrl+C`。
4.  脚本将自动保存到 `scripts/baidu-test` 目录下。

---

## 4. 运行脚本

运行已存在的脚本。

**基础运行：**
```bash
npm run cli -- run <脚本ID>
```
例如运行刚才录制的 `baidu-test`：
```bash
npm run cli -- run baidu-test
```

**高级选项：**

*   **保持登录状态（记住 Cookie）**：
    如果您希望脚本记住登录状态（例如免登录），请添加 `--persist-login` 和 `--storage-key` 参数。
    ```bash
    npm run cli -- run baidu-test --persist-login --storage-key my-session
    ```

*   **有头模式（看到浏览器界面）**：
    默认情况下脚本可能是无头运行的（取决于配置）。如果想强制看到浏览器界面，可以在脚本代码的 `launchBrowser` 选项中设置 `headless: false`，或者修改默认配置。

*   **指定代理**：
    ```bash
    npm run cli -- run baidu-test --proxy proxy-cn-1
    ```

---

## 5. 常见问题

*   **报错 "Make sure orchestrator is running"**：
    请检查是否执行了第 1 步的 `npm start`，并且该终端窗口没有报错或关闭。

*   **脚本运行了一半停止了**：
    检查主控服务（`npm start` 的窗口）是否有报错日志。
