# 增强系统级异常处理与降级机制

为了确保脚本在长时间运行中的稳定性，防止单篇笔记的报错或网络超时导致整个任务中断，我们将实施以下“系统级”的鲁棒性增强：

## 1. 主循环安全网 (Note-Level Safety)
在 `scripts/xiaohongshu/index.js` 的批量处理循环中增加 `try-catch` 保护。
- **现状**：如果创建页面 (`context.newPage()`) 或 `interactWithItem` 内部抛出未捕获异常，脚本会崩溃。
- **改进**：捕获单篇笔记处理过程中的所有异常，打印错误日志，**强制继续**处理下一篇笔记。

## 2. 页面资源安全释放
优化 `interactWithItem` 的 `finally` 块。
- **改进**：在关闭页面 (`page.close()`) 时增加容错处理。如果页面因崩溃已关闭，不再抛出二次错误，确保资源释放流程不阻塞主循环。

## 3. 远程调用降级策略 (AI Timeout Downgrade)
确认并微调 `coze-client.js` 和 `index.js` 的配合逻辑。
- **现状**：`coze-client.js` 已有超时处理（返回空字符串）。
- **确认**：在 `index.js` 中，当 AI 返回空（超时/错误）时，明确记录“降级日志”，并**跳过回复动作**。
- **流程**：AI 失败 -> 跳过回复 -> 继续执行点赞/收藏 (如果有) -> 关闭当前页 -> **进行下一步（下一篇笔记）**。这完全符合您“降级不处理，进行下一步”的要求。

## 4. 实现步骤
1.  修改 `scripts/xiaohongshu/index.js`：在 `for (const item of newItems)` 循环内部包裹 `try-catch`。
2.  修改 `scripts/xiaohongshu/index.js`：在 `interactWithItem` 的 `finally` 中安全关闭页面。
3.  (可选) 微调日志，使其更清晰地反映“降级”状态。